<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description>Vaults Jenkins Build artefacts to SCM Subversion repository and creates DOD for them. &lt;br&gt;&lt;br&gt;&#xd;
DO NOT use that job for non-SABRE components!&#xd;
&lt;br&gt;&#xd;
&lt;font size=&quot;20&quot; style=&quot;color: red&quot;&gt;DO NOT RUN THAT JOB! &lt;strong&gt;SABRE-SCM-VAULT-AND-DOD&lt;/strong&gt; IS CORRECT JOB NAME&lt;/font&gt;</description>
  <logRotator class="hudson.tasks.LogRotator">
    <daysToKeep>-1</daysToKeep>
    <numToKeep>20</numToKeep>
    <artifactDaysToKeep>-1</artifactDaysToKeep>
    <artifactNumToKeep>-1</artifactNumToKeep>
  </logRotator>
  <keepDependencies>false</keepDependencies>
  <properties>
    <com.sonyericsson.jenkins.plugins.bfa.model.ScannerJobProperty plugin="build-failure-analyzer@1.11.0">
      <doNotScan>false</doNotScan>
    </com.sonyericsson.jenkins.plugins.bfa.model.ScannerJobProperty>
    <jenkins.advancedqueue.AdvancedQueueSorterJobProperty plugin="PrioritySorter@2.9">
      <useJobPriority>false</useJobPriority>
      <priority>-1</priority>
    </jenkins.advancedqueue.AdvancedQueueSorterJobProperty>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.StringParameterDefinition>
          <name>SCM_USERNAME</name>
          <description></description>
          <defaultValue>def</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.PasswordParameterDefinition>
          <name>SCM_PASSWORD</name>
          <description></description>
          <defaultValue>aaa</defaultValue>
        </hudson.model.PasswordParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>COMPONENT</name>
          <description>Component name to be vaulted. No spaces!</description>
          <defaultValue></defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>VERSION</name>
          <description>This parameter is not used in this job and onl required because of upstream job</description>
          <defaultValue></defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>ARTEFACT_URL</name>
          <description>This parameter is not used in this job and onl required because of upstream job</description>
          <defaultValue></defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.plugins.validating__string__parameter.ValidatingStringParameterDefinition plugin="validating-string-parameter@2.2">
          <name>IMPLEMENTATION_START_TIME</name>
          <description>parameter for the implementation datetime of CR</description>
          <defaultValue></defaultValue>
          <regex>(?!0000)[0-9]{4}-((0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-8])|(0[13-9]|1[0-2])-(29|30)|(0[13578]|1[02])-31)T([01][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]</regex>
          <failedValidationMessage>Invalid datetime: The datetime format should be yyyy-MM-ddTHH:mm:ss, like 2015-01-31T23:59:00</failedValidationMessage>
        </hudson.plugins.validating__string__parameter.ValidatingStringParameterDefinition>
        <hudson.model.FileParameterDefinition>
          <name>EVIDENCE</name>
          <description></description>
        </hudson.model.FileParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>YAML_PATH</name>
          <description>Location of the configuration YAML file (as described in &lt;a href=&quot;http://gmwiki.uk.standardchartered.com:8080/display/GMSD/Automated+SCM+vaulting#AutomatedSCMvaulting-SCMDODconfigurationparameters&quot;&gt;Wiki page&lt;/a&gt;) Default location is for SABRE submissions only.</description>
          <defaultValue>bootstrap/meta/projects/BASE/dod_config.yaml</defaultValue>
        </hudson.model.StringParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
    <com.sonyericsson.rebuild.RebuildSettings plugin="rebuild@1.22">
      <autoRebuild>false</autoRebuild>
    </com.sonyericsson.rebuild.RebuildSettings>
    <org.jvnet.hudson.plugins.shelveproject.ShelveProjectProperty plugin="shelve-project-plugin@1.5"/>
  </properties>
  <scm class="hudson.plugins.git.GitSCM" plugin="git@2.3.1">
    <configVersion>2</configVersion>
    <userRemoteConfigs>
      <hudson.plugins.git.UserRemoteConfig>
        <name>origin</name>
        <refspec>+refs/heads/integration:refs/remotes/origin/integration</refspec>
        <url>ssh://git@stash/cd/bootstrap.git</url>
      </hudson.plugins.git.UserRemoteConfig>
    </userRemoteConfigs>
    <branches>
      <hudson.plugins.git.BranchSpec>
        <name>integration</name>
      </hudson.plugins.git.BranchSpec>
    </branches>
    <doGenerateSubmoduleConfigurations>false</doGenerateSubmoduleConfigurations>
    <submoduleCfg class="list"/>
    <extensions>
      <hudson.plugins.git.extensions.impl.RelativeTargetDirectory>
        <relativeTargetDir>bootstrap</relativeTargetDir>
      </hudson.plugins.git.extensions.impl.RelativeTargetDirectory>
    </extensions>
  </scm>
  <assignedNode>master</assignedNode>
  <canRoam>false</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <jdk>(Default)</jdk>
  <triggers/>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <jenkins.plugins.shiningpanda.builders.CustomPythonBuilder plugin="shiningpanda@0.21">
      <home>/home/sabredev/virtualenv/jenkins</home>
      <nature>shell</nature>
      <command>#!/bin/bash +x

export SVN_PYTHON_TRACE=True
export http_proxy=http://10.192.126.40:8080
export https_proxy=http://10.192.126.40:8080
#export http_proxy=http://10.192.116.73:8080
#export https_proxy=http://10.192.116.73:8080

if [[ &quot;${ARTEFACT_URL}&quot; == &quot;&quot; ]]; then
    echo &quot;This job cannot be executed directly. Please run &lt;a href=&quot;http://sabrebuild1.uk.standardchartered.com:8080/job/SABRE-SCM-VAULT-AND-DOD&quot;&gt;SABRE-SCM-VAULT-AND-DOD&lt;/a&gt;&quot;
fi

if [[ ! -f EVIDENCE ]]; then
    echo &quot;You must provide test evidence file (field EVIDENCE in this job parameters}&quot;
    exit 1
fi

python bootstrap/meta/py/scm_dod_maker.py --loglevel DEBUG submit --dod $DOD_NUMBER --project &quot;$COMPONENT&quot; --user $SCM_USERNAME --password $SCM_PASSWORD --cr $CR_NUMBER --config $YAML_PATH --appr &quot;$PSS_APPROVER&quot; --implement $IMPLEMENTATION_START_TIME --evidence EVIDENCE</command>
      <ignoreExitCode>false</ignoreExitCode>
    </jenkins.plugins.shiningpanda.builders.CustomPythonBuilder>
  </builders>
  <publishers>
    <hudson.tasks.Mailer plugin="mailer@1.12">
      <recipients>email@exmple.com</recipients>
      <dontNotifyEveryUnstableBuild>false</dontNotifyEveryUnstableBuild>
      <sendToIndividuals>true</sendToIndividuals>
    </hudson.tasks.Mailer>
  </publishers>
  <buildWrappers>
    <com.michelin.cio.hudson.plugins.maskpasswords.MaskPasswordsBuildWrapper/>
    <org.jenkinsci.plugins.buildnamesetter.BuildNameSetter plugin="build-name-setter@1.3">
      <template>${ENV,var=&quot;COMPONENT&quot;}-${ENV,var=&quot;VERSION&quot;}-${ENV,var=&quot;DOD_NUMBER&quot;}</template>
    </org.jenkinsci.plugins.buildnamesetter.BuildNameSetter>
  </buildWrappers>
</project>
